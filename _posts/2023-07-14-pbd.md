---
layout: post
author: Lionel Pigou
title: "GPU Rigid Body Physics Simulation Based on Position Based Dynamics"
tags: [game development, game physics]
date: 2021-01-01
---

<!-- Prompt:
Write a blog post in markdown titled "GPU Rigid Body Physics Simulation Based on Position Based Dynamics". Go a deeper for each pointer.
Context: my game Meor is a smooth voxel game that runs mostly on GPU. Since the terrain is on GPU I implemented a physics system on GPU as well.
Content:
- The Rigid body physics simulation is based on the Position Based Dynamics (PBD) method
- Rigid body objects are constructed from particles. So each model in the game needs to be converted to particles.
- Particles collide with the voxel terrain using the (truncated) signed distance field stored in the voxels
- Particles collide with each other by storing the particles in a grid based on location. We look for particles in the surrounding cells to collide with. Each cell has a linked list with particles.
- Particles are connected through constraints by shape-matching the original rigid body shape. We estimate the new position and rotation of the rigid body and force the particles towards their original shape  each physics step -->

{% include youtube.html id="tCwfpcqTNkI" height="20rem"%}
My voxel-based game, Meor, primarily runs on the GPU. One crucial aspect of creating a realistic and immersive game experience is implementing an efficient physics system. In this blog post, I will delve a tiny bit deeper into the GPU rigid body physics simulation technique I have employed, which is based on the Position Based Dynamics (PBD) method.


## Position Based Dynamics (PBD)

Position Based Dynamics is a physics simulation technique that has gained popularity due to its stability and ease of implementation. It is particularly suitable for real-time simulations, making it an excellent choice for games like Meor. Unlike traditional approaches that rely on forces and constraints, PBD utilizes a position-based formulation.

Instead of calculating forces and resolving them over time, PBD solves for the final positions of the objects directly. By iteratively adjusting the positions based on the desired constraints, such as collisions and shape-matching, the simulation achieves stability and accuracy.

## Rigid Body Objects as Particles
{% include youtube.html id="JjgECznVrI0" height="20rem"%}

In Meor, rigid body objects are constructed using particles. To integrate them into the physics simulation, every model in the game needs to be converted into a set of particles. These particles represent the mass and geometry of the rigid body, allowing it to interact with the surrounding environment.

## Particle-Terrain Collision
{% include youtube.html id="XYzq4lQwsIE" height="20rem"%}

One of the key challenges in GPU physics simulation is handling collisions between particles and the voxel terrain efficiently. In Meor, I utilize a (truncated) signed distance field stored in the voxels to handle these collisions. By comparing the particles' positions to the distance field, I can determine if a collision has occurred and take appropriate action.


## Particle-Particle Collision
{% include youtube.html id="D59Qs_MwU2Y" height="20rem"%}

Particles within the simulation also interact with each other. To efficiently handle particle-particle collisions, I organize the particles into a grid based on their spatial location. Each cell of the grid contains a linked list of particles that reside within it. This data structure allows me to quickly find neighboring particles for collision detection. By examining particles in the surrounding cells, I can identify potential collisions and resolve them accordingly.

## Constraints for Shape-Matching
{% include youtube.html id="idrPjHNi0us" height="20rem"%}

To maintain the structural integrity of the rigid bodies, particles are connected through constraints based on shape-matching. The original shape of the rigid body is used as a reference, and constraints are applied to force the particles towards their original positions and orientations. By estimating the new position and rotation of the rigid body, I can update the particles' positions at each physics step to maintain their shape.

## Conclusion

Implementing a robust and efficient GPU rigid body physics simulation is crucial for creating a realistic and immersive gaming experience. By utilizing the Position Based Dynamics method, Meor's physics system achieves stability and accuracy. Converting models into particles, handling particle-terrain and particle-particle collisions, and applying constraints for shape-matching are essential components of this simulation.

The GPU-based physics system in Meor demonstrates the power and versatility of modern graphics hardware. With the ability to handle complex interactions in real-time, the game's physics simulation adds a new level of realism and immersion. Stay tuned for future updates on Meor as I continue to refine and optimize the physics system to enhance gameplay and player experience.


<!-- {% include youtube.html id="gAi85HcIrec" height="20rem"%} -->
 
