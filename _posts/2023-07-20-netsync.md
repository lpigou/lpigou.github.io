---
layout: post
author: Lionel Pigou
title: "Network Synchronized Multiplayer Boss Encounters"
tags: [game development, netcode]
date: 2021-01-01
---

**_Disclaimer_**: The text in this post is generated by an AI chatbot based on a few bullet points.


<!-- Prompt:
Write a blog post in markdown titled "Network Synchronized Multiplayer Boss Encounters". Go a deeper for each pointer and improve my English writing.
Context: my game Meor is a smooth voxel game that runs mostly on GPU.
Content:
- In my voxel game, I want fluid simulations on GPU. It needed to conserve mass of course.
- I started with Eulerian method based on Harris, Mark J. "Fast fluid dynamics simulation on the GPU.". The problem is that mass is not conserved. The fluid dissipated after a while.
- I took some inspiration from the paper: Chentanez, Nuttapong, and Matthias Müller. "Mass-conserving Eulerian liquid simulation.". We first determine local masses with a connected components algorithm implemented on GPU. The we calculate the mass for each component before a simulation step. Then we correct the mass for each component by adding or subtracting mass.
- In the end I stepped away from this approach because it was not performant enough. It was 3 to 6 milliseconds on a GTX 980, and I didn't want to spend so much performance budget (my target is only about 17ms) just for fluid alone. I ended up using a grid sweeping method where fluid mass is swept over in one direction per pass. Each different fluid material have a different viscosity and moves at a different rate. Cellular automata would have been another solution, but this made the fluid move a lot slower compared to the grid sweeping method. 
-->

{% include youtube.html id="HxCGCTAR4xA" height="20rem"%}

Fluid simulations in voxel games can greatly enhance the overall gameplay experience, adding realism and immersion. As a developer of the smooth voxel game Meor, I set out to implement fluid simulations on the GPU, with a primary focus on conserving mass. In this blog post, I will discuss the challenges I faced, the approaches I explored, and the ultimate solution I settled on.

## Euler's Method
{% include youtube.html id="wJy126LANJc" height="20rem"%}

To begin with, I decided to adopt the Eulerian method based on the work of Harris, Mark J. in his paper titled "Fast fluid dynamics simulation on the GPU." This approach seemed promising, but I soon encountered a significant problem - mass conservation. The fluid would dissipate over time, leading to an unrealistic simulation.

In my quest for a solution, I delved into existing research, drawing inspiration from the paper by Chentanez, Nuttapong, and Matthias Müller, titled "Mass-conserving Eulerian liquid simulation." This research proposed a method that involved determining local masses using a connected components algorithm implemented on the GPU. By calculating the mass for each component before each simulation step, they were able to correct the mass by adding or subtracting as necessary.

While the mass-conserving Eulerian method appeared to address the issue of mass dissipation, I soon encountered another hurdle - performance. The implementation was not performant enough for my needs. On a GTX 980, the computation time ranged from 3 to 6 milliseconds, which exceeded the performance budget I had set for fluid simulations alone. As a result, I had to seek an alternative solution.

## Grid Sweeping Method
{% include youtube.html id="ZSFO1e8M2GA" height="20rem"%}

After careful consideration, I opted for a grid sweeping method to achieve the desired fluid simulation. This approach involved sweeping the fluid mass over the grid in a specific direction during each pass. Notably, different fluid materials had varying viscosities and moved at different rates, which added complexity to the simulation.

Compared to other potential alternatives such as cellular automata, the grid sweeping method proved to be more efficient in terms of fluid movement speed. While cellular automata could have been a viable solution, it significantly slowed down the fluid simulation process.

## Conclusion

Implementing fluid simulations in a voxel game posed several challenges, particularly in terms of mass conservation and performance. While initially adopting the Eulerian method showed promise, it fell short in terms of conserving mass effectively. Seeking inspiration from related research helped me understand the intricacies of the problem better, but ultimately, the performance limitations led me to explore alternative solutions.

The grid sweeping method emerged as the most viable choice, allowing for efficient fluid movement while maintaining acceptable performance levels. As a game developer, striking a balance between realism and performance is crucial, and I believe that the solution I settled on for fluid simulations in Meor achieves that balance.

By continually experimenting, learning, and refining our approaches, we can push the boundaries of what's possible in game development, creating more immersive and captivating experiences for players. The journey of implementing fluid simulations in Meor has been an enlightening one, and I'm excited to continue exploring new techniques and advancements in the field.